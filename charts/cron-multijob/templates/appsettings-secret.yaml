{{- range $index, $cronjob := $.Values.cronjobs }}
{{- if or ($cronjob.appConfigFilesEnabled) ($.Values.global.appConfigFilesEnabled) -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "charts-cron-multijob.fullname" (dict "root" $ "cronjob" $cronjob "index" $index) }}-files
  labels:
    chart: {{ $.Chart.Name }}-{{ $.Chart.Version | replace "+" "_" }}
    {{- include "charts-cron-multijob.labels" (dict "root" $ "cronjob" $cronjob) | nindent 4 }}
data:
{{- $globPattern := $cronjob.appConfigFiles.globPattern | default $.Values.global.appConfigFiles.globPattern -}}
{{- if $globPattern -}}
  {{ $currentScope := $}}
  {{ range $path, $_ :=  $.Files.Glob $globPattern }}
  {{- with $currentScope}}
{{- $path }}: |-
{{ .Files.Get $path | b64enc | indent 4 }}
  {{- end }}
  {{ end }}
{{- end -}}
{{- $filesList := $cronjob.appConfigFiles.filesList | default $.Values.global.appConfigFiles.filesList -}}
{{- if $filesList -}}
  {{- $files := $.Files }}
  {{- range $filesList }}
  {{- . }}: |-
{{ $files.Get . | b64enc | indent 4 }}
  {{- end }}
{{- end -}}
{{- end -}}
{{- end -}}